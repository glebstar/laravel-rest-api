version: '3'
services:

  #PHP Service
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: digitalocean.com/php
    container_name: app
    restart: unless-stopped
    tty: true
    environment:
      SERVICE_NAME: app
      SERVICE_TAGS: dev
    working_dir: /var/www
    volumes:
      - ./:/var/www
      - ./php/local.ini:/usr/local/etc/php/conf.d/local.ini
    networks:
      - app-network

  postgres:
    image: postgres:9.5-alpine
    container_name: ${PROJECT_NAME}-postgres
    volumes:
       - "./sourcefiles/postgres:/var/lib/postgresql/data"
    environment:
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - POSTGRES_DB=${POSTGRES_DB}
    ports:
     - "5432:5432"
    networks:
          testing_net:
              ipv4_address: 172.28.1.2
  webserver:
    image: nginx:alpine
    container_name: ${PROJECT_NAME}-webserver
    working_dir: /application
    volumes:
        - ./application:/application
        - ./sourcefiles/nginx:/etc/nginx/conf.d
    ports:
     - "80:80"
    networks:
          testing_net:
              ipv4_address: 172.28.1.3

  networks:
    testing_net:
        ipam:
            driver: default
            config:
                - subnet: 172.28.0.0/16
